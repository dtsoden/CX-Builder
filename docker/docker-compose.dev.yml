name: cx-builder

# DEV MODE - Hot reload for UI changes
# Usage: docker-compose -f docker-compose.dev.yml up
# UI will be at http://localhost:5173 (Vite dev server)
# API will be at http://localhost:3000

services:
    cx-builder-dev:
        image: node:20-alpine
        working_dir: /app
        command: sh -c "apk add --no-cache git python3 py3-pip make g++ build-base cairo-dev pango-dev && npm install -g pnpm@9 && pnpm install && pnpm build && pnpm dev"
        environment:
            - PORT=9800
            - DATABASE_PATH=/data
            - SECRETKEY_PATH=/data
            - LOG_PATH=/data/logs
            - BLOB_STORAGE_PATH=/data/storage
            - BROWSER=none
            - VITE_PORT=5173
            - VITE_HOST=0.0.0.0
        ports:
            - '5173:5173'   # Vite dev server (UI)
        volumes:
            - ..:/app                           # Mount source code
            - ./LocalLiveDockerData:/data       # Persist data
            - dev_node_modules:/app/node_modules  # Cache node_modules in volume
        stdin_open: true
        tty: true

volumes:
    dev_node_modules:
